<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Write your site description here. It will be used as your sites meta description as well!">

    <title>TADP</title>

    <link rel="canonical" href="http://uqbar-project.github.io/scripts/clase_3/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">TADP</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/quienessomos/">Quienes Somos</a>
                </li>
                
                <li>
                    <a href="/administrativos/">Temas Administrativos</a>
                </li>
                
                <li>
                    <a href="/contenidos/">Contenidos</a>
                </li>
                
                <li>
                    <a href="/cursada/">Cursada</a>
                </li>
                
                <li>
                    <a href="/material/">Material</a>
                </li>
                
                <li>
                    <a href="/planificación/">Planificación</a>
                </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>TADP</h1>
                    <hr class="small">
                    <span class="subheading">Script Clase 3 TADP 1C2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<div class="container">
	<div class="row">
		<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
			<h1 id="metaprogramacion">METAPROGRAMACION</h1>
<p>Es el proceso o la práctica por la cual escribimos programas que generan, manipulan o utilizan otros programas.</p>

<h6 id="ejemplos">Ejemplos</h6>
<ul>
  <li>Un compilador se puede pensar como un programa que genera otro programa.</li>
  <li>Un formateador de código es un programa que manipula otro programa.</li>
  <li>Una herramienta como javadoc utiliza nuestro programa para generar su documentación.</li>
</ul>

<h6 id="para-qu-se-usa-la-metaprogramacin">Para qué se usa la metaprogramación?</h6>
<p>En general la metaprogramación se utiliza más fuertemente en el desarrollo de frameworks y herramientas.</p>

<p>Dado que los frameworks van a resolver cierta problemática de las aplicaciones, no van a estar diseñados para ninguna en particular. Es decir, la idea de framework es que se va a poder aplicar y utilizar en diferentes dominios desconocidos para el creador del framework.</p>

<p>Ejemplos:</p>

<ul>
  <li>ORM’s (como hibernate): Que van a encargarse de persistir las instancias de nuestras clases sin siquiera conocerlas de antemano.</li>
  <li>Frameworks de UI: Que deberán saber mostras / bindear cualquier objeto.</li>
  <li>Frameworks de Testing (como JUnit): suelen usar metaprogramación para analizar la clase de Test y encontrar los tests que se deben correr.</li>
  <li>Javadoc: Es una herramienta como el compilador de java, que lee el código fuente y genera documentación.</li>
  <li>Code Coverage: Herramientas que miden cuánto de nuestro código es realmente ejecutado al correr los tests, y cuales lineas no.</li>
  <li>Analizadores de código: Que evalúan nuestro código y genera métrics o miden violaciones a reglas definidas. Como el estilo de código, complejidad ciclomática, etc.</li>
</ul>

<h2 id="reflection">Reflection</h2>
<p>Es un caso particular de metaprogramación, donde “metaprogramamos” en el mismo lenguaje en que están escritos (o vamos a escribir) los programas. Es decir, todo desde el mismo lenguaje.</p>

<h3 id="tipos-de-reflection">Tipos de reflection</h3>
<p>Para esto, generalmente, es necesario contar con facilidades o herramientas específicas, digamos “soporte” del lenguaje. Entonces reflection, además, abarca los siguientes items que vamos a mencionar en esta lista:</p>

<ul>
  <li><strong>Introspection</strong>:Se refiere a la capacidad de un sistema, de analizarse a sí mismo. Algo así como la introspección humana, pero en términos de programa. Para eso, el lenguaje debe proveer ciertas herramientas, que le permitan al mismo programa, “ver” o “reflejar” cada uno de sus componentes.</li>
  <li><strong>Self-Modification</strong>:Es la capacidad de un programa de modificarse a sí mismo. Nuevamente esto requiere cierto soporte del lenguaje. Y las limitaciones van a depender de este soporte.</li>
  <li><strong>Intercession</strong>:Es la capacidad de modificar la semántica del modelo que estamos manipulando,desde el mismo lenguaje.</li>
</ul>

<h3 id="modelos-y-metamodelos">Modelos y metamodelos</h3>
<p>Así como todo programa construye un modelo para describir su dominio, los lenguajes pueden hacer lo mismo para describir sus abstracciones. El domino de un metaprograma son los programas.</p>

<p>El programa describe las características de los elementos del dominio utilizando clases, métodos, atributos entre otros. Entonces, el modelo puede contener por ejemplo una clase Guerrero, que modela a los guerreros en el domino.</p>

<p>Un metaprograma usará el metamodelo que describe al programa base. Así como en el dominio hay guerreros, los elementos del “metadominio” (= programa base) serán los construcciones del lenguaje, por ejemplo, clases, atributos, métodos.</p>

<h1 id="practica">Practica</h1>
<p>Vamos a usar el código de la clase anterior como ejemplo https://github.com/uqbar-paco/tadp-ruby-age-of-empires</p>

<p>Podemos comenzar con un poco de introspection y preguntarle a un objeto desde su clase hasta que metodos tiene.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>atila = <span style="color:#036;font-weight:bold">Guerrero</span>.new
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>atila.class  <span style="color:#777">#=&gt; Guerrero</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>atila.class.superclass  <span style="color:#777">#=&gt; Object</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>atila.methods  <span style="color:#777">#=&gt; [:potencial_defensivo, :sufri_danio, :descansar, :energia, :energia=,...] </span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.instance_methods <span style="color:#777">#=&gt; Idem a atila.methods</span>
<span class="line-numbers"><a href="#n7" name="n7">7</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.instance_methods(<span style="color:#069">false</span>) <span style="color:#777">#=&gt; [:descansar_atacante, :descansar_defensor,...] (solo los de la clase guerrero)</span>
</pre></div>
</div>
</div>

<p>Tambien podemos empezar a interactuar con los objetos de otra manera, como mandarle mensajes de otra manera.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>atila.send(<span style="color:#A60">:potencial_ofensivo</span>)  <span style="color:#777">#=&gt; 20</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>atila.send(<span style="color:#A60">:descansar</span>)  <span style="color:#777">#=&gt; 110</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#777"># con send no existen los metodos privados, la seguridad es una sensacion</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">A</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>    private
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">metodo_privado</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cosa privada, no te metas</span><span style="color:#710">'</span></span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>    <span style="color:#080;font-weight:bold">end</span>    
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>objeto = <span style="color:#036;font-weight:bold">A</span>.new
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>objeto.metodo_privado <span style="color:#777">#=&gt; NoMethodError: private method `metodo_privado' called for #&lt;A:direccion en memoria del objeto&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>objeto.send(<span style="color:#A60">:metodo_privado</span>)  <span style="color:#777">#=&gt; &quot;cosa privada, no te metas&quot;</span>
</pre></div>
</div>
</div>

<p>Tambien podemos obtener un metodo e invocarlo</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>metodo = atila.method(<span style="color:#A60">:potencial_ofensivo</span>)  <span style="color:#777">#=&gt; #&lt;Method: Guerrero(Atacante)#potencial_ofensivo&gt;</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>metodo.call  <span style="color:#777">#=&gt; 20</span>
</pre></div>
</div>
</div>

<p>Algo interesante que podemos hacer es pedirle un metodo de instancia a una clase. A este metodo se lo llama UnBound method, ya que no esta asociado a ninguna instancia de esa clase. Podemos asociarlo a un objeto siempre y cuando este dentro de la jerarquia de clases.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Padre</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">correr</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">correr como padre</span><span style="color:#710">'</span></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Hijo</span> &lt; <span style="color:#036;font-weight:bold">Padre</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">correr</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>        <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">correr como hijo</span><span style="color:#710">'</span></span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>    <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>metodo = <span style="color:#036;font-weight:bold">Padre</span>.instance_method(<span style="color:#A60">:correr</span>)  <span style="color:#777">#=&gt;#&lt;UnboundMethod: Padre#correr&gt;</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>metodo.bind(<span style="color:#036;font-weight:bold">Hijo</span>.new).call  <span style="color:#777">#=&gt; 'correr como padre'</span>
</pre></div>
</div>
</div>

<p>Como vemos los Unbound methods se escapan al metodo lookup.
Tambien podemos pregunarle a los metodos cosas.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>metodo = atila.method(<span style="color:#A60">:atacar</span>) <span style="color:#777">#=&gt; #&lt;Method: Guerrero(Atacante)#atacar&gt;</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>metodo.arity  <span style="color:#777">#=&gt; 1</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>metodo.parameters <span style="color:#777">#=&gt; [[:req, :un_defensor]]</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>metodo.owner  <span style="color:#777">#=&gt; Atacante (donde esta definido)</span>
</pre></div>
</div>
</div>

<p>Asi como ya estuvimos jugando con las clases, objetos y metodos, tambien podemos jugar con las variables.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>atila.instance_variables <span style="color:#777">#=&gt; [:@potencial_ofensivo, :@energia, :@potencial_defensivo]</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>atila.instance_variable_get(<span style="color:#A60">:@energia</span>)  <span style="color:#777">#=&gt; 100</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>atila.instance_variable_set(<span style="color:#A60">:@energia</span>, <span style="color:#00D">50</span>) <span style="color:#777">#=&gt; 50</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>atila.instance_variable_get(<span style="color:#A60">:@energia</span>)  <span style="color:#777">#=&gt; 50</span>
</pre></div>
</div>
</div>

<h3 id="self-modification">Self-Modification</h3>
<p>Open classes</p>

<p>Nos permite definir métodos y atributos en una clase ya existente.
Es una forma de self modification con azucar sintáctica para no tener que hacerlo mediante mensajes.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">String</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">importante</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>    <span style="color:#069">self</span> + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">!</span><span style="color:#710">'</span></span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span><span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">aprobe</span><span style="color:#710">'</span></span>.importante  <span style="color:#777">#=&gt; &quot;aprobe!&quot;</span>
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span><span style="color:#777">#Cambiar métodos</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Fixnum</span>
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">+</span>(x)
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>    <span style="color:#00D">123</span>
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n13" name="n13">13</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n14" name="n14">14</a></span><span style="color:#00D">2</span>+<span style="color:#00D">2</span>  <span style="color:#777">#=&gt; 123</span>
</pre></div>
</div>
</div>

<p>Otra manera de abrir las clases y definir metodos es usando en la clase el define_method pero este es privado y como ya vimos podemos pasarlo por arriba invocando el send.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span> 
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.send(<span style="color:#A60">:define_method</span>, <span style="color:#A60">:saluda</span>) {
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola</span><span style="color:#710">'</span></span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>}
<span class="line-numbers"><a href="#n5" name="n5">5</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.new.saluda  <span style="color:#777">#=&gt; &quot;Hola&quot;</span>
</pre></div>
</div>
</div>

<p>Aca podemos hacer referencia a dos practicas de programacion
Duck Typing y Monkey patching</p>

<h4 id="duck-typing">Duck Typing</h4>
<p>Debido a que ruby es un lenguaje dinamicamente tipado, hacemos referencia a un tipo de dato por el comportamiento que tiene.
&gt;…if it walks like a duck and talks like a duck, it’s a duck, right? </p>

<p>Si tenemos un objeto que cuando hace ruido hace “cuak” y camina como un pato, probablemente lo sea, y deberia poder continuar usando este objeto como si fuera uno.</p>

<h4 id="monkey-patching">Monkey Patching</h4>
<blockquote>
  <p>…if it walks like a duck and talks like a duck, it’s a duck, right? So if this duck is not giving you the noise that you want, you’ve got to just punch that duck until it returns what you expect.</p>
</blockquote>

<p>Hace referencia a la posibilidad de practicamente modificar un tipo a gusto y piacere para que responda a nuestras necesidades y realizar otro tipo de operaciones como si fuera otro.</p>

<p>Tambien podemos empezar a hacer algunas cosas mas locas, como agregarle comportamiento a un unico objeto</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>atila.define_singleton_method(<span style="color:#A60">:saluda</span>) {
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>  <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Hola soy Atila</span><span style="color:#710">'</span></span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>}
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>atila.saluda  <span style="color:#777">#=&gt; &quot;Hola soy Atila&quot;</span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.new.saludo <span style="color:#777"># NoMethodError</span>
</pre></div>
</div>
</div>

<h2 id="metamodelo">METAMODELO</h2>

<p>Empezamos a dibujar el modelo de clases.
Vamos a jugar un poco más con el metamodelo, ya sabemos que existe el mensaje class que lo entienden todos los objetos, si queremos saber la superclase de una clase tenemos el mensaje superclass. Podríamos pensar en base a eso quiénes le proveen comportamiento a cada uno de nuestros objetos.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>zorro = <span style="color:#036;font-weight:bold">Espadachin</span>.new(<span style="color:#036;font-weight:bold">Espada</span>.new(<span style="color:#00D">123</span>))
</pre></div>
</div>
</div>

<p>Tenemos al zorro que es instancia de Espadachin, que hereda de Guerrero. Si le pedimos los métodos al zorro vemos que incluye a los instance_methods de Espadachin y de Guerrero, así como todos los que se definen para las instancias de Object.</p>

<h3 id="autoclases-eigenclass">Autoclases-EigenClass</h3>
<p>Pero nosotros no le agregamos comportamiento sólo a las instancias, también teníamos un par de métodos de clase que habíamos definido para Peloton, como por ejemplo cobarde.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Peloton</span>.cobarde([])
</pre></div>
</div>
</div>

<p>Quién provee ese comportamiento? La clase de Peloton es Class, y este comportamiento no se agregó para todas las clases así que no puede estar definido dentro de Class.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Peloton</span>.methods.include? <span style="color:#A60">:cobarde</span>  <span style="color:#777">#=&gt; true</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span><span style="color:#036;font-weight:bold">Peloton</span>.class.instance_methods.include? <span style="color:#A60">:new</span>  <span style="color:#777">#=&gt; true</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span><span style="color:#036;font-weight:bold">Peloton</span>.class.instance_methods.include? <span style="color:#A60">:cobarde</span>  <span style="color:#777">#=&gt; false</span>
</pre></div>
</div>
</div>

<p>Esto sólo lo entiende la clase Peloton, o sea que está definido para un sólo objeto. El objeto que le provee el comportamiento a un sólo objeto es la autoclase. En Ruby podemos obtener la autoclase de un objeto mandándole singleton_class.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Peloton</span>.singleton_class.instance_methods(<span style="color:#069">false</span>)  <span style="color:#777">#=&gt; [:cobarde]</span>
</pre></div>
</div>
</div>

<p>Todos los objetos tienen una singleton class, con lo cual podemos definirle comportamiento a atila y que sea el único guerrero con ese comportamiento.
Incluir un mixin a una instancia(con include en la singleton class o extend en la intancia):</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">module</span> <span style="color:#B06;font-weight:bold">W</span>
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">m</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span>    <span style="color:#00D">123</span>
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>a = <span style="color:#036;font-weight:bold">Guerrero</span>.new
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>a.singleton_class.include <span style="color:#036;font-weight:bold">W</span>
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>a.m  <span style="color:#777">#=&gt; 123</span>
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>b = <span style="color:#036;font-weight:bold">Guerrero</span>.new
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>b.extend <span style="color:#036;font-weight:bold">W</span>
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>b.m  <span style="color:#777">#=&gt;123</span>
</pre></div>
</div>
</div>

<p>Agregamos el test en el que atila cuando se lastima descansa y se come un pollo incorporando esta línea para que entienda comerse_un_pollo</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>atila = <span style="color:#036;font-weight:bold">Guerrero</span>.new
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>atila.singleton_class.send(<span style="color:#A60">:define_method</span>, <span style="color:#A60">:comerse_un_pollo</span>, proc { <span style="color:#33B">@energia</span> += <span style="color:#00D">20</span> })
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>atila.energia
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>atila.comerse_un_pollo
<span class="line-numbers"><a href="#n5" name="n5">5</a></span>atila.energia
<span class="line-numbers"><a href="#n6" name="n6">6</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.new.comerse_un_pollo  <span style="color:#777"># NoMethodError</span>
</pre></div>
</div>
</div>

<p>También vemos que se puede tener properties para un objeto solo</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>atila.singleton_class.send(<span style="color:#A60">:attr_accessor</span>, <span style="color:#A60">:edad</span>)
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>atila.edad = <span style="color:#00D">5</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>atila.edad  <span style="color:#777">#=&gt; 5</span>
<span class="line-numbers"><a href="#n4" name="n4">4</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.new.edad  <span style="color:#777">#=&gt; NoMethodError</span>
</pre></div>
</div>
</div>

<p>Vemos que no aparecen los mixins que tiene la clase Guerrero si vamos preguntando las super clases. El mensaje superclass no mustra los mixins (porque no son clases), para poder ver la linearización tenemos que pedir quienes proveen comportamiento con el mensaje ancestors.</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.ancestors  <span style="color:#777">#=&gt; [Guerrero, Defensor, Observable, Atacante, Object, Kernel, BasicObject]</span>
</pre></div>
</div>
</div>

<p>Nota: Las ultimas veriones de ruby incluyen a la singleton class de Guerrero, las anteriores a 2.1.0 NO incluyen a las singleton classes:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.new.singleton_class.ancestors
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span>[<span style="color:#777">#&lt;Class:#&lt;Guerrero:0x00000001d6c8c8&gt;&gt;,</span>
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span><span style="color:#036;font-weight:bold">Guerrero</span>,
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span><span style="color:#036;font-weight:bold">Defensor</span>,
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span><span style="color:#036;font-weight:bold">Atacante</span>,
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span><span style="color:#036;font-weight:bold">Object</span>,
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span><span style="color:#036;font-weight:bold">PP</span>::<span style="color:#036;font-weight:bold">ObjectMixin</span>,
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span><span style="color:#036;font-weight:bold">Kernel</span>,
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span><span style="color:#036;font-weight:bold">BasicObject</span>]
</pre></div>
</div>
</div>

<p>Dibujar los ancestors de Guerrero en el pizarron.
Dibujar la singleton class de atila.
Agregamos un método de clase a Guerrero:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Guerrero</span>
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>  <span style="color:#080;font-weight:bold">def</span> <span style="color:#069">self</span>.<span style="color:#06B;font-weight:bold">gritar</span>
<span class="line-numbers"><a href="#n3" name="n3">3</a></span>    “haaaa”
<span class="line-numbers"><a href="#n4" name="n4">4</a></span>  <span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n5" name="n5">5</a></span><span style="color:#080;font-weight:bold">end</span>
<span class="line-numbers"><a href="#n6" name="n6">6</a></span>atila.gritar  <span style="color:#777">#=&gt; NoMethodError</span>
<span class="line-numbers"><a href="#n7" name="n7">7</a></span><span style="color:#036;font-weight:bold">Guerrero</span>.gritar  <span style="color:#777">#=&gt; haaaa</span>
</pre></div>
</div>
</div>

<p>Dibujar la singleton class de Guerrero (donde definí “gritar”)</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span><span style="color:#036;font-weight:bold">Espadachin</span>.gritar  <span style="color:#777">#=&gt;haaaa</span>
</pre></div>
</div>
</div>

<p><img src="/scripts/Metamodelo_de_Ruby.jpg" alt="" /></p>

		</div>
	</div>
</div>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/uqbar-paco">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; TADP 2016</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
